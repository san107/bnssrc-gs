# HP 커튼형 프로토콜 

## 개요 

- 참조 문서 : 250116_차단막 커튼형 통신매뉴얼.pdf

## 커튼과 업/다운 모두있는데, 어떻게 상태 체크를 할 것인가? 

- 둘다 down, 둘다 up 상태를 체크하도록 하자. 
- 나중에 변경이 쉽게 가능하도록 함수로 만들어 놓자. 

- 상태조회시에, 수위계정보 값을 읽어오도록 처리한다. 


```txt 
DI 40010.00 침수 자동 하강 모드 : 0 연동정지.  1 연동. ADDR_ONOFF_STAT
DI 40010.01 침수상태 : 0 정상, 1 침수. 
DO 40011.00 침수 자동 하강모드 연동 : 1 연동( 펄스제어 )  ADDR_ONOFF_CTRL
DO 40011.01 침수 자동 하강모드 연동정지 : 1 연동정지(펄스제어) 

AI    40016 초음파 수위 0 ~ 100 ADDR_WATER_LEVEL
AO/AI 40017 자동하강 수위 설정 0 ~ 100 ADDR_DOWN_LEVEL_SET
AO/AI 40018 수위보정 -100 ~ +100 ADDR_WATER_LVL_ADJST

```

```txt
커튼형 수위계는 하나의 장비에 접점 방식고, 초음파 방식 2개가 설치 되는 구조이고, 
각각이 수위계로 인식된다. 
커튼형 수위게는 차단기의 주기적인 체크에서 동작하게 되므로, 차단기가 동작해야만 수위계도 동작할 수 있도록 구조가 된다. 
하나의 차단기는, 1차로, 2차로, 3차로 등의 여러 차단기를 제어한다. 즉, 여러 차단기가 존재하는데, 
그렇다면, 각 차로별로 수위계값을 처리할 필요가 없다. 따라서, 차단기 수위계의 처리는 처리하고 나서 10초 이후에 수신되는 것을 처리할 수 있도로 한다. 
```


## 수위계 관련. 

### 할일

- 30 초에 한번 체크하도록 수정. : write 처리. 
- read 실패시 재시도 하도록 : 특히, 데몬에서 처리 할 때는, 
- 접점식 수위계 2단계 처리하독 수정. 
- 차단막프로토콜자료_지하차로_R6_1_함2개용.pdf ( 수위계 프로토콜 참조 )

### 차단막프로토콜자료_지하차로_R6_1_함2개용.pdf 수위계 프로토콜 정리. ( 노란색부분 )

아래는 매뉴얼의 주소이므로 -1 하여 사용해야 함. 

- AI INT 4 14222 수위접접신호 1 ~ 16 . 1,2 가 처리되며, 1은 warn, 2는 crit 으로 처리하면 될 것임. 
- AI FLOAT 4 14204 수위센서#1. 4byte를 읽은다음, float로 변환하여 처리하면 됨. cm로 들어오므로, 1/100 로 처리하면 됨. 
- AI WORD 4 14201 30초마다 값변경. 60초간 변경 없으면 통신 이상으로 간주. 

### 테스트 수위계 정보. 

```txt 
   커튼형 차단막 MODBUS 접속 주소
      DDNS : hpsystem.iptime.org 
      IP : 222.114.91.42
      PORT : 602

   상하형 싱글 MODBUS 접속 주소
      DDNS : hpsystem.iptime.org
      PORT : 702   
```

